# Derivatives Export API

## Endpoint

```
GET /api/packs/:pack_id/derivatives/export
```

Export derivatives for a content pack in JSON or Markdown format.

## Parameters

### Path Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `pack_id` | string | Yes | The ID of the content pack |

### Query Parameters

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| `format` | string | No | `json` | Export format: `json` or `md` |

## Response Formats

### JSON Format

Returns a structured JSON object with derivatives and metadata.

**Content-Type:** `application/json`

**Response Structure:**

```json
{
  "pack_id": "pack-123",
  "status": "draft",
  "created_at": "2024-01-15T10:30:00Z",
  "derivatives": {
    "x": ["Tweet 1", "Tweet 2", "Tweet 3"],
    "linkedin": ["LinkedIn post 1", "LinkedIn post 2"],
    "newsletter": "Newsletter content...",
    "blog_summary": "Blog summary content..."
  },
  "seo": {
    "title": "SEO Title",
    "slug": "seo-slug",
    "description": "SEO description"
  },
  "metadata": {
    "x_count": 3,
    "linkedin_count": 2,
    "has_newsletter": true,
    "has_blog_summary": true
  }
}
```

### Markdown Format

Returns a formatted Markdown document with all derivatives.

**Content-Type:** `text/markdown; charset=utf-8`

**Example Output:**

```markdown
# Content Pack Derivatives

**Pack ID:** pack-123
**Status:** draft
**Created:** 1/15/2024

---

## üîç SEO Metadata

**Title:** The Ultimate Guide to AI

**Slug:** ultimate-guide-ai-2024

**Description:** Discover the latest AI trends...

---

## üê¶ X/Twitter Posts (3)

### Post 1

üöÄ Excited to announce our new product launch!

*Character count: 45/280*

### Post 2

Just shipped a major update to our platform.

*Character count: 42/280*

---

## üíº LinkedIn Posts (2)

### Post 1

> I'm thrilled to share that our team has been working
> on something truly transformative...

*Character count: 145*

---

## üìß Newsletter

Newsletter content goes here...

---

## üìù Blog Summary

Blog summary content goes here...

---

*Generated by Content Multiplier*
```

## Examples

### Export as JSON

```bash
curl "http://localhost:3001/api/packs/pack-123/derivatives/export"
```

or explicitly:

```bash
curl "http://localhost:3001/api/packs/pack-123/derivatives/export?format=json"
```

### Export as Markdown

```bash
curl "http://localhost:3001/api/packs/pack-123/derivatives/export?format=md"
```

### Download to File

**JSON:**
```bash
curl "http://localhost:3001/api/packs/pack-123/derivatives/export?format=json" \
  -o pack-123-derivatives.json
```

**Markdown:**
```bash
curl "http://localhost:3001/api/packs/pack-123/derivatives/export?format=md" \
  -o pack-123-derivatives.md
```

### Using JavaScript/Fetch

```javascript
// Export as JSON
const response = await fetch(
  'http://localhost:3001/api/packs/pack-123/derivatives/export?format=json'
)
const data = await response.json()
console.log(data)

// Export as Markdown
const mdResponse = await fetch(
  'http://localhost:3001/api/packs/pack-123/derivatives/export?format=md'
)
const markdown = await mdResponse.text()
console.log(markdown)

// Download as file
const blob = await mdResponse.blob()
const url = window.URL.createObjectURL(blob)
const a = document.createElement('a')
a.href = url
a.download = 'derivatives.md'
a.click()
```

## Error Responses

### 400 Bad Request - Invalid Format

```json
{
  "error": "Invalid format. Supported formats: json, md"
}
```

### 404 Not Found - Pack Not Found

```json
{
  "error": "Pack not found"
}
```

### 404 Not Found - No Derivatives

```json
{
  "error": "No derivatives found for this pack"
}
```

## Use Cases

1. **Backup & Archive**: Export derivatives for backup or archival purposes
2. **Content Review**: Share derivatives with team members for review
3. **Integration**: Import derivatives into other systems or tools
4. **Documentation**: Generate documentation from content pack derivatives
5. **Version Control**: Track changes to derivatives over time

## Features

- ‚úÖ Two export formats: JSON and Markdown
- ‚úÖ Automatic file download headers
- ‚úÖ Character counts for social media posts
- ‚úÖ Formatted output with emojis and structure
- ‚úÖ Metadata included (counts, status, timestamps)
- ‚úÖ Error handling for invalid inputs
- ‚úÖ UTF-8 encoding support

## Notes

- The `Content-Disposition` header is set to `attachment`, which prompts browsers to download the file
- Markdown format includes character counts for X/Twitter posts to help track limits
- LinkedIn posts are formatted as blockquotes in Markdown
- All timestamps are in ISO 8601 format
- Empty or missing derivatives are handled gracefully


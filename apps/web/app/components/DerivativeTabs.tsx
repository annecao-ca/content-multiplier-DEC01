'use client'

import React from 'react'
import { Tabs, TabsList, TabsTrigger, TabsContent } from './ui/tabs'
import { Badge } from './ui/badge'
import { cn } from '@/app/lib/utils'

// Platform icons as SVG components
const TwitterIcon = ({ className }: { className?: string }) => (
  <svg className={className} viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
  </svg>
)

const LinkedInIcon = ({ className }: { className?: string }) => (
  <svg className={className} viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
  </svg>
)

const FacebookIcon = ({ className }: { className?: string }) => (
  <svg className={className} viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
  </svg>
)

const InstagramIcon = ({ className }: { className?: string }) => (
  <svg className={className} viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
  </svg>
)

const TikTokIcon = ({ className }: { className?: string }) => (
  <svg className={className} viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
    <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>
  </svg>
)

const MailchimpIcon = ({ className }: { className?: string }) => (
  <svg className={className} viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
    <path d="M21.193 14.478c-.465.8-1.113.801-1.576 0-.46-.795-.46-2.081 0-2.876.465-.8 1.113-.801 1.576 0 .46.795.46 2.081 0 2.876m-1.276-5.695c-1.326-.962-2.634-1.577-4.187-1.838-.127-.021-.256-.04-.386-.057a7.857 7.857 0 0 0-.55-.037c-.255-.015-.512-.025-.77-.03h-.008c-.166-.003-.332-.006-.498-.006-3.452 0-6.418 1.777-7.962 4.403-.023.04-.047.079-.07.12-.145.255-.277.517-.396.785a8.237 8.237 0 0 0-.331.908c-.048.155-.092.311-.131.468-.04.157-.076.315-.109.474-.033.16-.063.32-.089.481-.026.161-.048.322-.067.484-.019.161-.035.323-.047.486-.012.163-.021.325-.027.488-.006.163-.009.325-.009.489 0 4.537 3.68 8.215 8.215 8.215 4.535 0 8.215-3.678 8.215-8.215 0-.164-.003-.326-.009-.489-.006-.163-.015-.325-.027-.488-.012-.163-.028-.325-.047-.486-.019-.162-.041-.323-.067-.484-.026-.161-.056-.321-.089-.481-.033-.159-.069-.317-.109-.474-.039-.157-.083-.313-.131-.468a8.237 8.237 0 0 0-.331-.908 7.991 7.991 0 0 0-.396-.785c-.023-.041-.047-.08-.07-.12-.159-.27-.329-.534-.51-.791-.009-.013-.019-.025-.029-.037-.164-.233-.337-.46-.519-.68.142.215.275.435.398.66.123.225.238.455.344.69.106.235.203.474.29.717.087.243.164.489.231.738.067.249.123.5.17.754.047.254.083.51.11.768.027.258.044.518.051.779.007.261.005.523-.006.785-.011.262-.032.525-.063.788-.031.263-.072.525-.123.787-.051.262-.112.523-.183.783-.071.26-.152.519-.243.776-.091.257-.192.512-.303.765-.111.253-.232.504-.363.753-.131.249-.272.496-.423.74-.151.244-.312.485-.483.724-.171.239-.352.475-.543.707-.191.232-.392.461-.603.686-.211.225-.432.446-.663.663-.231.217-.472.43-.723.638-.251.208-.512.411-.783.609-.271.198-.552.391-.843.578-.291.187-.591.369-.901.545-.31.176-.63.346-.959.51-.329.164-.668.322-1.016.473-.348.151-.705.295-1.071.432-.366.137-.741.267-1.125.389-.384.122-.777.236-1.178.343-.401.107-.81.206-1.228.296-.418.09-.844.172-1.278.245-.434.073-.876.137-1.325.192-.449.055-.905.101-1.368.138-.463.037-.933.065-1.408.084-.475.019-.957.029-1.445.03-.488.001-.981-.007-1.479-.024a24.033 24.033 0 0 1-1.513-.1 24.09 24.09 0 0 1-1.543-.199c-.516-.089-1.031-.193-1.544-.312-.513-.119-1.024-.253-1.532-.402-.508-.149-1.013-.313-1.515-.492-.502-.179-1.001-.372-1.495-.58-.494-.208-.984-.431-1.468-.668-.484-.237-.963-.489-1.435-.755a22.778 22.778 0 0 1-1.386-.859 22.5 22.5 0 0 1-1.323-.972 22.17 22.17 0 0 1-1.245-1.091c-.402-.379-.792-.771-1.168-1.176-.376-.405-.738-.823-1.085-1.254-.347-.431-.679-.874-.995-1.329-.316-.455-.616-.923-.898-1.402-.282-.479-.547-.969-.794-1.469-.247-.5-.477-1.01-.688-1.529-.211-.519-.403-1.047-.576-1.584-.173-.537-.327-1.083-.461-1.637-.134-.554-.248-1.116-.342-1.686-.094-.57-.167-1.147-.22-1.731-.053-.584-.085-1.175-.096-1.772-.011-.597-.002-1.2.027-1.808.029-.608.078-1.221.147-1.839.069-.618.158-1.24.267-1.866.109-.626.238-1.257.387-1.891.149-.634.318-1.272.507-1.912.189-.64.398-1.283.627-1.927.229-.644.478-1.289.747-1.935.269-.646.558-1.292.867-1.937.309-.645.637-1.289.985-1.931.348-.642.715-1.282 1.101-1.919.386-.637.791-1.271 1.215-1.901.424-.63.867-1.256 1.328-1.878.461-.622.94-1.239 1.437-1.851.497-.612 1.011-1.219 1.543-1.819.532-.6 1.081-1.194 1.647-1.781.566-.587 1.148-1.167 1.746-1.739.598-.572 1.212-1.136 1.84-1.692.628-.556 1.271-1.103 1.928-1.641.657-.538 1.328-1.067 2.012-1.585.684-.518 1.381-1.025 2.089-1.522.708-.497 1.428-.982 2.158-1.456.73-.474 1.471-.935 2.22-1.384.749-.449 1.508-.885 2.275-1.308.767-.423 1.542-.833 2.324-1.229.782-.396 1.571-.778 2.366-1.146.795-.368 1.596-.721 2.402-1.059.806-.338 1.617-.661 2.432-.969.815-.308 1.634-.601 2.456-.878.822-.277 1.647-.538 2.475-.784.828-.246 1.658-.476 2.49-.69.832-.214 1.666-.412 2.501-.594.835-.182 1.671-.348 2.508-.498.837-.15 1.674-.284 2.511-.402.837-.118 1.674-.22 2.51-.306.836-.086 1.672-.156 2.507-.21.835-.054 1.669-.092 2.502-.114.833-.022 1.665-.028 2.495-.018.83.01 1.659.035 2.486.075.827.04 1.652.095 2.475.165.823.07 1.643.155 2.461.255.818.1 1.633.215 2.445.345.812.13 1.621.275 2.427.435.806.16 1.608.335 2.407.525.799.19 1.593.395 2.383.615.79.22 1.576.455 2.357.705.781.25 1.557.515 2.328.795.771.28 1.537.575 2.298.885.761.31 1.516.635 2.266.975.75.34 1.494.695 2.232 1.065.738.37 1.47.755 2.196 1.155.726.4 1.445.815 2.158 1.245.713.43 1.419.875 2.118 1.335.699.46 1.391.935 2.076 1.425.685.49 1.362.995 2.031 1.515.669.52 1.33 1.055 1.983 1.605.653.55 1.298 1.115 1.934 1.695.636.58 1.263 1.175 1.881 1.785.618.61 1.226 1.235 1.825 1.875.599.64 1.188 1.295 1.766 1.965.578.67 1.146 1.355 1.703 2.055.557.7 1.103 1.415 1.637 2.145.534.73 1.056 1.475 1.566 2.235.51.76 1.008 1.535 1.493 2.325.485.79.957 1.595 1.416 2.415.459.82.904 1.655 1.336 2.505.432.85.85 1.715 1.254 2.595.404.88.793 1.775 1.167 2.685.374.91.733 1.835 1.076 2.775.343.94.671 1.895.983 2.865.312.97.608 1.955.887 2.955.279 1 .541 2.015.786 3.045.245 1.03.473 2.075.684 3.135.211 1.06.404 2.135.579 3.225.175 1.09.332 2.195.471 3.315.139 1.12.259 2.255.361 3.405.102 1.15.185 2.315.249 3.495.064 1.18.109 2.375.135 3.585.026 1.21.033 2.435.021 3.675-.012 1.24-.045 2.495-.099 3.765-.054 1.27-.129 2.555-.225 3.855-.096 1.3-.213 2.615-.351 3.945-.138 1.33-.297 2.675-.477 4.035-.18 1.36-.381 2.735-.603 4.125-.222 1.39-.465 2.795-.729 4.215-.264 1.42-.549 2.855-.855 4.305-.306 1.45-.633 2.915-.981 4.395-.348 1.48-.717 2.975-1.107 4.485-.39 1.51-.801 3.035-1.233 4.575-.432 1.54-.885 3.095-1.359 4.665-.474 1.57-.969 3.155-1.485 4.755-.516 1.6-1.053 3.215-1.611 4.845-.558 1.63-1.137 3.275-1.737 4.935-.6 1.66-1.221 3.335-1.863 5.025-.642 1.69-1.305 3.395-1.989 5.115-.684 1.72-1.389 3.455-2.115 5.205-.726 1.75-1.473 3.515-2.241 5.295-.768 1.78-1.557 3.575-2.367 5.385-.81 1.81-1.641 3.635-2.493 5.475-.852 1.84-1.725 3.695-2.619 5.565-.894 1.87-1.809 3.755-2.745 5.655-.936 1.9-1.893 3.815-2.871 5.745-.978 1.93-1.977 3.875-2.997 5.835-1.02 1.96-2.061 3.935-3.123 5.925-1.062 1.99-2.145 3.995-3.249 6.015-1.104 2.02-2.229 4.055-3.375 6.105-1.146 2.05-2.313 4.115-3.501 6.195-1.188 2.08-2.397 4.175-3.627 6.285-1.23 2.11-2.481 4.235-3.753 6.375-1.272 2.14-2.565 4.295-3.879 6.465-1.314 2.17-2.649 4.355-4.005 6.555-1.356 2.2-2.733 4.415-5.13 6.645"/>
  </svg>
)

const WordPressIcon = ({ className }: { className?: string }) => (
  <svg className={className} viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
    <path d="M21.469 6.825c.84 1.537 1.318 3.3 1.318 5.175 0 3.979-2.156 7.456-5.363 9.325l3.295-9.527c.615-1.54.82-2.771.82-3.864 0-.405-.026-.78-.07-1.11m-7.981.105c.647-.03 1.232-.105 1.232-.105.582-.075.514-.93-.067-.899 0 0-1.755.135-2.88.135-1.064 0-2.85-.15-2.85-.15-.585-.03-.661.855-.075.885 0 0 .54.061 1.125.09l1.68 4.605-2.37 7.08L5.354 6.9c.649-.03 1.234-.1 1.234-.1.585-.075.516-.93-.065-.896 0 0-1.746.138-2.874.138-.2 0-.438-.008-.69-.015C5.036 3.238 8.205 1.5 11.8 1.5c2.655 0 5.076 1.01 6.89 2.664-.045-.003-.087-.008-.132-.008-1.064 0-1.81.923-1.81 1.914 0 .89.513 1.643 1.06 2.531.411.72.89 1.643.89 2.977 0 .915-.354 1.994-.821 3.479l-1.075 3.585-3.9-11.61.001.014zM12 22.784c-1.059 0-2.081-.153-3.048-.437l3.237-9.406 3.315 9.087c.024.053.05.101.078.149-1.12.393-2.325.607-3.582.607M1.211 12c0-1.564.336-3.05.935-4.39L7.29 21.709C3.694 19.96 1.212 16.271 1.211 12M12 0C5.385 0 0 5.385 0 12s5.385 12 12 12 12-5.385 12-12S18.615 0 12 0"/>
  </svg>
)

export interface PlatformConfig {
  id: string
  name: string
  icon: React.ReactNode
  limit: number
}

export interface DerivativeTabsProps {
  platforms?: PlatformConfig[]
  contents?: Record<string, string>
  onContentChange?: (platformId: string, content: string) => void
  defaultValue?: string
  className?: string
}

const DEFAULT_PLATFORMS: PlatformConfig[] = [
  { id: 'twitter', name: 'Twitter', icon: <TwitterIcon className="w-4 h-4" />, limit: 280 },
  { id: 'linkedin', name: 'LinkedIn', icon: <LinkedInIcon className="w-4 h-4" />, limit: 3000 },
  { id: 'facebook', name: 'Facebook', icon: <FacebookIcon className="w-4 h-4" />, limit: 63206 },
  { id: 'instagram', name: 'Instagram', icon: <InstagramIcon className="w-4 h-4" />, limit: 2200 },
  { id: 'tiktok', name: 'TikTok', icon: <TikTokIcon className="w-4 h-4" />, limit: 150 },
  { id: 'mailchimp', name: 'Mailchimp', icon: <MailchimpIcon className="w-4 h-4" />, limit: 5000 },
  { id: 'wordpress', name: 'WordPress', icon: <WordPressIcon className="w-4 h-4" />, limit: 10000 },
]

export function DerivativeTabs({
  platforms = DEFAULT_PLATFORMS,
  contents = {},
  onContentChange,
  defaultValue,
  className,
}: DerivativeTabsProps) {
  const [activeTab, setActiveTab] = React.useState<string>(defaultValue || platforms[0]?.id || '')

  const getCharCount = (platformId: string): number => {
    return contents[platformId]?.length || 0
  }

  const isWithinLimit = (platformId: string): boolean => {
    const platform = platforms.find((p) => p.id === platformId)
    if (!platform) return true
    return getCharCount(platformId) <= platform.limit
  }

  const handleContentChange = (platformId: string, value: string) => {
    onContentChange?.(platformId, value)
  }

  return (
    <div className={cn('w-full', className)}>
      <Tabs value={activeTab} onValueChange={setActiveTab}>
        <TabsList className="w-full justify-start overflow-x-auto">
          {platforms.map((platform) => {
            const charCount = getCharCount(platform.id)
            const withinLimit = isWithinLimit(platform.id)

            return (
              <TabsTrigger
                key={platform.id}
                value={platform.id}
                className="flex items-center gap-2 data-[state=active]:bg-white data-[state=active]:text-gray-950"
              >
                <span className="flex-shrink-0">{platform.icon}</span>
                <span className="hidden sm:inline">{platform.name}</span>
                <Badge
                  variant={withinLimit ? 'outline' : 'destructive'}
                  className={cn(
                    'ml-1',
                    withinLimit
                      ? 'bg-green-500 hover:bg-green-600 border-green-500 text-white dark:bg-green-600 dark:hover:bg-green-700 dark:border-green-600 dark:text-white'
                      : ''
                  )}
                >
                  {charCount}/{platform.limit}
                </Badge>
              </TabsTrigger>
            )
          })}
        </TabsList>

        {platforms.map((platform) => (
          <TabsContent key={platform.id} value={platform.id} className="mt-4">
            <div className="space-y-2">
              <textarea
                value={contents[platform.id] || ''}
                onChange={(e) => handleContentChange(platform.id, e.target.value)}
                placeholder={`Nhập nội dung cho ${platform.name}...`}
                className="w-full min-h-[200px] px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-y"
              />
              <div className="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400">
                <span>
                  {getCharCount(platform.id)} / {platform.limit} ký tự
                </span>
                {!isWithinLimit(platform.id) && (
                  <span className="text-red-500 font-medium">
                    Vượt quá {getCharCount(platform.id) - platform.limit} ký tự
                  </span>
                )}
              </div>
            </div>
          </TabsContent>
        ))}
      </Tabs>
    </div>
  )
}

